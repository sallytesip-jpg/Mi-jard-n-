<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cultivo Pro</title>

  <!-- PWA / Iconos (ajusta rutas si usas otras) -->
  <link rel="manifest" href="/manifest.webmanifest" />
  <link rel="icon" sizes="192x192" href="/icons/icon-192.png" />
  <link rel="icon" sizes="512x512" href="/icons/icon-512.png" />
  <meta name="theme-color" content="#0f172a" />

  <!-- Estilos r√°pidos embebidos -->
  <style>
    :root{
      --bg:#0b1220;--panel:#111827;--muted:#94a3b8;--text:#e5e7eb;--pri:#22c55e;--pri-2:#16a34a;--warn:#f59e0b;--err:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;
      background: radial-gradient(1200px 800px at 20% -10%, #0c1a2a 0%, #0b1220 40%, #0b1220 100%);
      color:var(--text);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    header{
      display:flex; align-items:center; gap:.75rem; padding:20px 16px; border-bottom:1px solid #1f2937;
      position:sticky; top:0; backdrop-filter: blur(6px);
      background: linear-gradient(180deg, rgba(11,18,32,.85), rgba(11,18,32,.65));
      z-index:5;
    }
    header img{width:36px;height:36px;border-radius:10px}
    header h1{margin:0;font-size:1.15rem;letter-spacing:.3px}
    header small{display:block;color:var(--muted);font-weight:500}
    main{max-width:900px;margin:24px auto;padding:0 16px 40px}
    .grid{display:grid; gap:16px}
    @media (min-width:900px){ .grid{grid-template-columns: 1fr 1fr; } }

    .card{
      background: linear-gradient(180deg,#0f172a,#0b1423);
      border:1px solid #1f2937; border-radius:16px; padding:18px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.03);
    }
    .card h2{margin:.2rem 0 1rem 0; font-size:1.05rem}
    .muted{color:var(--muted); font-size:.92rem}
    .badge{display:inline-flex;align-items:center;gap:.4rem;background:#052e1a;color:#86efac;border:1px solid #064e3b;border-radius:999px;padding:.25rem .6rem;font-size:.75rem}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}

    /* Formulario */
    form{display:grid; gap:10px}
    input[type="text"]{
      background:#0b1220;border:1px solid #263244;color:#e5e7eb;border-radius:12px;padding:12px 14px;font-size:1rem;outline:none;
    }
    input[type="text"]::placeholder{color:#94a3b8}
    button{
      border:0; padding:12px 14px; border-radius:12px; color:white; font-weight:600; cursor:pointer;
      background: linear-gradient(180deg,var(--pri),var(--pri-2));
      box-shadow: 0 6px 18px rgba(34,197,94,.25);
    }
    button:active{transform:translateY(1px)}
    .status{margin-top:8px;font-size:.9rem}
    .ok{color:#86efac} .err{color:#fecaca}

    /* Lista */
    ul{list-style:none;margin:0;padding:0;display:grid;gap:10px}
    li{
      background:#0b1220;border:1px solid #1f2937;border-radius:12px;padding:12px 14px;display:flex;justify-content:space-between;align-items:center;
    }
    .stamp{color:#94a3b8;font-size:.8rem}
    footer{margin-top:26px;color:#94a3b8;font-size:.85rem;text-align:center}
  </style>
</head>
<body>
  <header>
    <img src="/icons/icon-192.png" alt="Cultivo Pro" />
    <div>
      <h1>Cultivo Pro</h1>
      <small>Gesti√≥n de cultivo + recordatorios en la nube</small>
    </div>
    <span class="badge" style="margin-left:auto">PWA lista</span>
  </header>

  <main>
    <div class="grid">
      <!-- Tarjeta: nuevo recordatorio -->
      <section class="card">
        <h2>‚ûï A√±adir recordatorio</h2>
        <p class="muted">Gu√°rdalo en tu Firebase (Firestore) para verlo en cualquier dispositivo.</p>
        <form id="form-recordatorio" autocomplete="off">
          <input type="text" id="texto" placeholder="Ej.: Aplicar micorrizas el viernes" required />
          <div class="row">
            <button type="submit">Guardar</button>
            <span id="estado" class="status"></span>
          </div>
        </form>
      </section>

      <!-- Tarjeta: recordatorios guardados -->
      <section class="card">
        <h2>üìã Recordatorios</h2>
        <p class="muted">Se actualiza en tiempo real (no necesitas recargar).</p>
        <ul id="lista"></ul>
      </section>
    </div>

    <footer>
      Jos√© &amp; Sally ‚Ä¢ THC ‚öóÔ∏è + c√≠tricos üçã ‚Ä¢ v1.0
    </footer>
  </main>

  <!-- ====================== L√ìGICA FIREBASE ====================== -->
  <script type="module">
    /* Importa tu app inicializada desde src/firebase-config.js
       (ese archivo lo creaste con initializeApp y getAnalytics) */
    import { app } from "./src/firebase-config.js";

    /* SDKs de Firebase (desde CDN) */
    import {
      getFirestore, collection, addDoc, serverTimestamp,
      onSnapshot, orderBy, query
    } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

    const db = getFirestore(app);

    // DOM
    const form = document.getElementById("form-recordatorio");
    const estado = document.getElementById("estado");
    const lista = document.getElementById("lista");

    // Guardar
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const txt = document.getElementById("texto").value.trim();
      if (!txt) return;

      estado.textContent = "Guardando‚Ä¶";
      estado.className = "status";

      try {
        await addDoc(collection(db, "recordatorios"), {
          texto: txt,
          fecha: serverTimestamp()
        });
        estado.textContent = "‚úÖ Guardado en Firestore";
        estado.className = "status ok";
        form.reset();
      } catch (err) {
        console.error(err);
        estado.textContent = "‚ùå Error al guardar";
        estado.className = "status err";
      }
    });

    // Listado en tiempo real (√∫ltimos primero)
    const q = query(collection(db, "recordatorios"), orderBy("fecha", "desc"));
    onSnapshot(q, (snap) => {
      lista.innerHTML = "";
      if (snap.empty) {
        lista.innerHTML = '<li><span class="muted">Sin recordatorios a√∫n.</span></li>';
        return;
      }
      snap.forEach(doc => {
        const d = doc.data();
        const fecha = d.fecha?.toDate ? d.fecha.toDate() : null;
        const li = document.createElement("li");
        li.innerHTML = `
          <span>${d.texto}</span>
          <span class="stamp">${fecha ? fecha.toLocaleString() : "‚Ä¶"}</span>
        `;
        lista.appendChild(li);
      });
    });

    // PWA: registro del Service Worker (opcional, no falla si no existe)
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/sw.js").catch(()=>{});
    }
  </script>
</body>
</html>
